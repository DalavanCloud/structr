<?xml version="1.0" standalone="no"?>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>WebSocket Test</title>
    <style type="text/css">
    	h4, p { margin:0px; margin-top:10px; }
    	textarea, input { border:1px solid #cccccc; background-color:#fafafa;
    	width:500px; }
    </style>
  <script type="text/javascript" lanugage="JavaScript">
  
  function connect() {

    try {

        var host = document.location.host;
        if ('WebSocket' in window) {
            ws = new WebSocket('ws://' + host + '/structr-web-test/ws/', 'structr');
        } else if ('MozWebSocket' in window) {
            ws = new MozWebSocket('ws://localhost:8080/structr-web-test/ws/', 'structr');
        } else {
            alert('Your browser doesn\'t support WebSocket.');
            return;
        }
        
        log('State: ' + ws.readyState);

        ws.onopen = function() {
            log('Open: ' + ws.readyState);
        }

        ws.onmessage = function(message) {
            log('Message: ' + message.data);
            var msg = eval("(" + message.data + ")");
            if(msg.token) {
            	document.getElementById("token").value = msg.token;
            }
        }

        ws.onclose = function() {
            log('Close: ' + ws.readyState);
        }

    } catch (exception) {
        log('Error: ' + exception);
    }
    
}

function send(text) {

    if (!text) {
        log('No text to send!');
        return;
    }

    try {

        ws.send(text);
        log('Sent: ' + text);

    } catch (exception) {
        log('Error: ' + exception);
    }

}

function log(msg) {
	var logElement = document.getElementById("log");
	logElement.innerHTML = msg + "<br />" + logElement.innerHTML; 
}

function login() {
	send('{ "command":"LOGIN", "data" : { "username" : "chrisi", "password" : "wurst432" } }');
}

function sendData() {

	var token = document.getElementById("token").value;
	var id = document.getElementById("id").value;
	var cmd = document.getElementById("cmd").value;
	var pageSize = document.getElementById("pageSize").value;
	var page = document.getElementById("page").value;
	var data = document.getElementById("data").value;
	
	send('{ "command":"' + cmd + '", "id" : "' + id + '", "pageSize" : ' + pageSize + ', "page" : ' + page + ', "token" : "' + token + '", "data" : ' + data + ' }');
}

  </script>
  </head>
  <body>
  	<table>
  	<tr><td><h4>token</h4></td><td><p><input type="text" id="token" name="token" /></p></td></tr>
  	<tr><td><h4>id</h4></td><td><p><input type="text" id="id" name="id" /></p></td></tr>
  	<tr><td><h4>cmd</h4></td><td><p><input type="text" id="cmd" name="cmd" /></p></td></tr>
   	<tr><td><h4>pageSize</h4></td><td><p><input type="text" id="pageSize" name="pageSize" /></p></td></tr>
   	<tr><td><h4>page</h4></td><td><p><input type="text" id="page" name="page" /></p></td></tr>
  	<tr><td><h4>data</h4></td><td><p><textarea id="data" name="data" rows="5" cols="80"></textarea></p></td></tr>
  	</table>
  	<button onclick='sendData()'>Send</button><br /><br /><br /><br />
  	<button onclick='connect()'>Connect</button>
  	<button onclick='login()'>Login</button>
  	<button onclick='document.getElementById("log").innerHTML = "";'>Clear</button><br /><br />
  	<div id="log"></div>
  </body>
</html>








